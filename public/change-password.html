<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Change Password - Lakastah Makan Cafe</title>
<link rel="stylesheet" href="styles.css">
<link rel="manifest" href="manifest.json">


<style>
/* Toast Notification */
.toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: #fff;
    padding: 0.8rem 1.5rem;
    border-radius: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s, transform 0.3s;
    z-index: 20;
}

.toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

/* Save Button */
.btn-primary {
    width: 100%;
    padding: 0.95rem;
    background: linear-gradient(135deg, #eb9d00, #f9a600);
    color: #fff;
    border: none;
    border-radius: 25px;
    font-size: 1.05rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(255,126,95,0.3);
    transition: all 0.2s ease-in-out;
}

.btn-primary:hover {
    box-shadow: 0 8px 20px rgba(255,126,95,0.4);
    transform: translateY(-2px);
}

.btn-primary:active {
    transform: translateY(0);
    box-shadow: 0 4px 10px rgba(255,126,95,0.2);
}

/* Back Button */
.back-btn {
    font-size: 24px;
    cursor: pointer;
    margin-bottom: 12px;
    display: inline-block;
}
</style>
</head>

<body>
<div class="container">

    <!-- Page Header -->
    <div class="header">
        <button class="back-btn" onclick="history.back()">‚Üê</button>
        <h2 class="page-title">Change Password</h2>
    </div>

    <!-- Password Form -->
    <div class="profile-section">
        <h3 class="section-title">Update Password</h3>

        <div class="form-group">
            <label class="form-label">Current Password</label>
            <input type="password" class="form-input" id="currentPass" placeholder="Enter current password">
        </div>

        <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" class="form-input" id="newPass" placeholder="Enter new password">
        </div>

        <div class="form-group">
            <label class="form-label">Confirm New Password</label>
            <input type="password" class="form-input" id="confirmPass" placeholder="Re-enter new password">
        </div>

        <button class="btn-primary" id="savePasswordBtn" style="margin-top:2rem;">Save</button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Password Updated!</div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="deals.html" class="nav-item">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Deals</span>
        </a>
        <a href="meals.html" class="nav-item">
            <span class="nav-icon">üçΩ</span>
            <span class="nav-label">Menu</span>
        </a>
        <a href="rewards.html" class="nav-item">
            <span class="nav-icon">üéÅ</span>
            <span class="nav-label">Reward</span>
        </a>
        <a href="cart.html" a class="nav-item">
            <span class="nav-icon">üõí</span>
            <span class="nav-label">Cart</span>
        </a>
        <a href="profile.html" class="nav-item active">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">You</span>
        </a>
    </nav>
</div>

<!-- Page Protection -->
<script>
    const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
    if (!loggedInUser) window.location.href = "login.html";
</script>

<script>
// Elements
const currentPass = document.getElementById("currentPass");
const newPass = document.getElementById("newPass");
const confirmPass = document.getElementById("confirmPass");
const savePasswordBtn = document.getElementById("savePasswordBtn");
const toast = document.getElementById("toast");

// Save New Password
savePasswordBtn.addEventListener("click", () => {
    const user = JSON.parse(localStorage.getItem("loggedInUser"));
    let users = JSON.parse(localStorage.getItem("users")) || [];

    // Check current password
    const storedUser = users.find(u => u.id === user.id);

    if (!storedUser || storedUser.password !== currentPass.value) {
        alert("‚ùå Current password is incorrect.");
        return;
    }

    // Validate new password match
    if (newPass.value !== confirmPass.value) {
        alert("‚ùå New passwords do not match.");
        return;
    }

    if (newPass.value.length < 4) {
        alert("‚ùå Password must be at least 4 characters.");
        return;
    }

    // Update password in database
    storedUser.password = newPass.value;

    // Save updated users array
    localStorage.setItem("users", JSON.stringify(users));

    // Show toast
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2000);

    // Clear Inputs
    currentPass.value = "";
    newPass.value = "";
    confirmPass.value = "";
});

</script>

<script>
// After updating users[], also update loggedInUser so the new password stays active
savePasswordBtn.addEventListener("click", () => {

    // Reload updated users list
    const updatedUsers = JSON.parse(localStorage.getItem("users")) || [];
    const updatedUser = updatedUsers.find(u => u.id === loggedInUser.id);

    if (updatedUser) {
        // Save updated logged-in user
        localStorage.setItem("loggedInUser", JSON.stringify(updatedUser));
    }

});
</script>


</body>
</html>
